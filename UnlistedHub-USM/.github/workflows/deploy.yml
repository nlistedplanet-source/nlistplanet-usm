name: Auto Deploy to Vercel

on:
  push:
    branches:
      - main

jobs:
  deploy-desktop:
    name: Deploy Desktop Frontend
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 2

      - name: Check and Deploy Desktop
        run: |
          CHANGED=$(git diff --name-only HEAD~1 HEAD 2>/dev/null || echo "frontend")
          echo "Changed files: $CHANGED"
          
          if echo "$CHANGED" | grep -q "frontend/"; then
            echo "üñ•Ô∏è Desktop frontend changes detected!"
            echo "Calling deploy hook..."
            response=$(curl -s -X POST "${{ secrets.VERCEL_DESKTOP_DEPLOY_HOOK }}")
            echo "Response: $response"
            if echo "$response" | grep -q "PENDING"; then
              echo "‚úÖ Desktop deployment triggered successfully!"
            else
              echo "‚ùå No PENDING in response, but continuing..."
            fi
          else
            echo "‚è≠Ô∏è No frontend changes, skipping deploy"
          fi
